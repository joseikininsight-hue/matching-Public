# ğŸ¯ æœ€çµ‚ä¿®æ­£ã‚¬ã‚¤ãƒ‰

## ğŸ“‹ ç¾åœ¨ã®çŠ¶æ³

âœ… D1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ `åŠ©æˆé‡‘-db` ä½œæˆæ¸ˆã¿  
âœ… wrangler.toml ã«æ­£ã—ã„ Database ID è¨­å®šæ¸ˆã¿  
â³ Cloudflare Pages ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„

---

# ğŸ”§ å•é¡Œã®åŸå› 

Cloudflare Pages ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒ D1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’**è¦‹ã¤ã‘ã‚‰ã‚Œã¾ã›ã‚“**ã€‚

ã‚¨ãƒ©ãƒ¼:
```
binding DB of type d1 must have a database that already exists
```

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯å­˜åœ¨ã—ã¾ã™ãŒã€**Pages ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ãƒªãƒ³ã‚¯ã•ã‚Œã¦ã„ã¾ã›ã‚“**ã€‚

---

# âœ… è§£æ±ºæ–¹æ³•ï¼ˆ2ã¤ã®é¸æŠè‚¢ï¼‰

## ã‚ªãƒ—ã‚·ãƒ§ãƒ³ A: Cloudflare CLI ã§è¨­å®šï¼ˆæ¨å¥¨ï¼‰

### å‰ææ¡ä»¶

- Cloudflare API Token ãŒå¿…è¦
- ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å®Ÿè¡Œ

### æ‰‹é †

1. API Token ã‚’å–å¾—:
   - https://dash.cloudflare.com/profile/api-tokens
   - **Create Token** â†’ **Edit Cloudflare Workers** ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
   - ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚³ãƒ”ãƒ¼

2. ç’°å¢ƒå¤‰æ•°ã«è¨­å®š:
   ```bash
   export CLOUDFLARE_API_TOKEN="your-token-here"
   ```

3. D1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç¢ºèª:
   ```bash
   cd /home/user/webapp
   npx wrangler d1 list
   ```

4. Pages ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãƒã‚¤ãƒ³ãƒ‰:
   ```bash
   npx wrangler pages project binding add DB \
     --binding-name=DB \
     --database-id=12d97b60-7344-4d67-b53a-7f61b4f19ba6 \
     --project-name=matching-public
   ```

---

## ã‚ªãƒ—ã‚·ãƒ§ãƒ³ B: wrangler.toml ã‚’å‰Šé™¤ã—ã¦ Dashboard ã§è¨­å®š

### ã“ã®æ–¹æ³•ã‚’é¸ã¶ç†ç”±

- CLI ãŒä½¿ãˆãªã„ç’°å¢ƒ
- API Token ã®å–å¾—ãŒé›£ã—ã„
- Dashboard ã ã‘ã§å®Œçµã•ã›ãŸã„

### æ‰‹é †

#### 1. wrangler.toml ã‚’å®Œå…¨ã«å‰Šé™¤

```bash
cd /home/user/webapp
git rm wrangler.toml
git commit -m "remove: wrangler.toml to configure bindings via Dashboard only"
git push origin main
```

#### 2. ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ã‚’å¾…ã¤ï¼ˆ3åˆ†ï¼‰

#### 3. Dashboard ã§æ‰‹å‹•è¨­å®š

1. **Workers & Pages** â†’ **matching-public**
2. **Settings** ã‚¿ãƒ–
3. **Functions** ã‚»ã‚¯ã‚·ãƒ§ãƒ³
4. **D1 database bindings**
5. **Add binding** (ä»Šåº¦ã¯æŠ¼ã›ã‚‹ï¼)
6. å…¥åŠ›:
   ```
   Variable name: DB
   D1 database: åŠ©æˆé‡‘-db ã‚’é¸æŠ
   ```
7. **Save**

#### 4. å†ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ãƒˆãƒªã‚¬ãƒ¼

Dashboard ã§ **Deployments** â†’ **Retry deployment**

---

# ğŸ¯ ã©ã¡ã‚‰ã‚’é¸ã¶ï¼Ÿ

| æ–¹æ³• | é›£æ˜“åº¦ | æ‰€è¦æ™‚é–“ | æ¨å¥¨åº¦ |
|------|--------|---------|--------|
| ã‚ªãƒ—ã‚·ãƒ§ãƒ³A (CLI) | ä¸­ | 5åˆ† | â­â­â­ |
| ã‚ªãƒ—ã‚·ãƒ§ãƒ³B (Dashboard) | æ˜“ | 10åˆ† | â­â­â­â­â­ |

**æ¨å¥¨**: **ã‚ªãƒ—ã‚·ãƒ§ãƒ³ B**ï¼ˆDashboard ã§è¨­å®šï¼‰

ç†ç”±:
- ã‚¹ãƒãƒ›ã§ã‚‚å¯èƒ½
- API Token ä¸è¦
- è¦–è¦šçš„ã«ç¢ºèªã§ãã‚‹

---

# ğŸ“± ã‚ªãƒ—ã‚·ãƒ§ãƒ³ B ã®è©³ç´°æ‰‹é †ï¼ˆã‚¹ãƒãƒ›å¯¾å¿œï¼‰

## ã‚¹ãƒ†ãƒƒãƒ— 1: wrangler.toml ã‚’å‰Šé™¤

**ç§ãŒå®Ÿè¡Œã—ã¾ã™** - ã‚ãªãŸã¯ä½•ã‚‚ã—ãªãã¦OK

## ã‚¹ãƒ†ãƒƒãƒ— 2: ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ã‚’å¾…ã¤

1. Cloudflare Dashboard ã‚’é–‹ã
2. **Workers & Pages** â†’ **matching-public**
3. **Deployments** ã‚¿ãƒ–
4. æœ€æ–°ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãŒ **Success** ã«ãªã‚‹ã¾ã§å¾…ã¤ï¼ˆ3åˆ†ï¼‰

## ã‚¹ãƒ†ãƒƒãƒ— 3: D1 ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¿½åŠ 

1. **Settings** ã‚¿ãƒ–ã‚’ã‚¿ãƒƒãƒ—
2. ä¸‹ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« â†’ **Functions** ã‚»ã‚¯ã‚·ãƒ§ãƒ³
3. **D1 database bindings** ã‚’è¦‹ã¤ã‘ã‚‹
4. **Add binding** ã‚’ã‚¿ãƒƒãƒ—ï¼ˆä»Šåº¦ã¯æŠ¼ã›ã‚‹ï¼ï¼‰
5. å…¥åŠ›:
   ```
   Variable name: DB
   D1 database: åŠ©æˆé‡‘-db ã‚’é¸æŠ
   ```
6. **Save** ã‚’ã‚¿ãƒƒãƒ—

## ã‚¹ãƒ†ãƒƒãƒ— 4: ç¢ºèª

**Deployments** ã‚¿ãƒ–ã«æˆ»ã£ã¦ã€è‡ªå‹•çš„ã«å†ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

---

# ğŸ‰ å®Œäº†å¾Œ

## ã‚¢ãƒ—ãƒªã«ã‚¢ã‚¯ã‚»ã‚¹

```
https://5e807bf6.matching-public.pages.dev
```

## ãƒ‡ãƒ¼ã‚¿åŒæœŸ

```
https://5e807bf6.matching-public.pages.dev/api/sync/wordpress?max_pages=80
```

---

# ğŸ†˜ ãã‚Œã§ã‚‚ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆ

### ã‚±ãƒ¼ã‚¹ 1: "database not found"

**åŸå› **: Database ID ãŒé–“é•ã£ã¦ã„ã‚‹

**è§£æ±ºç­–**:
1. D1 Dashboard ã§ Database ID ã‚’å†ç¢ºèª
2. Settings â†’ Functions â†’ D1 bindings ã§æ­£ã—ã„ DB ã‚’é¸æŠ

### ã‚±ãƒ¼ã‚¹ 2: "Add binding" ãƒœã‚¿ãƒ³ãŒæŠ¼ã›ãªã„

**åŸå› **: ã¾ã  wrangler.toml ãŒæ®‹ã£ã¦ã„ã‚‹

**è§£æ±ºç­–**:
1. æœ€æ–°ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Œäº†ã—ã¦ã„ã‚‹ã‹ç¢ºèª
2. wrangler.toml ãŒå‰Šé™¤ã•ã‚ŒãŸã‚³ãƒŸãƒƒãƒˆãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

### ã‚±ãƒ¼ã‚¹ 3: ã‚¢ãƒ—ãƒªã¯å‹•ããŒãƒ‡ãƒ¼ã‚¿ãŒç©º

**åŸå› **: ãƒ‡ãƒ¼ã‚¿åŒæœŸãŒã¾ã 

**è§£æ±ºç­–**:
1. `/api/sync/wordpress?max_pages=80` ã«ã‚¢ã‚¯ã‚»ã‚¹
2. 2-3åˆ†å¾…ã¤
3. `/api/grants` ã§ç¢ºèª

---

# ğŸ“ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

**ã‚ãªãŸãŒã‚„ã‚‹ã“ã¨**:

1. ã€Œã‚ªãƒ—ã‚·ãƒ§ãƒ³ B ã§ãŠé¡˜ã„ã€ã¨è¿”ä¿¡
2. ç§ãŒ wrangler.toml ã‚’å‰Šé™¤
3. ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ã‚’å¾…ã¤
4. Dashboard ã§è¨­å®šï¼ˆç§ãŒæ¡ˆå†…ï¼‰

**æ‰€è¦æ™‚é–“**: ç´„ 10 åˆ†

---

**ã©ã†ã—ã¾ã™ã‹ï¼Ÿã‚ªãƒ—ã‚·ãƒ§ãƒ³ B ã§é€²ã‚ã¦OKã§ã™ã‹ï¼Ÿ** ğŸ‘
